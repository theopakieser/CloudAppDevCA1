"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = void 0;
const client_dynamodb_1 = require("@aws-sdk/client-dynamodb");
const util_dynamodb_1 = require("@aws-sdk/util-dynamodb");
const client = new client_dynamodb_1.DynamoDBClient({});
const handler = async (event) => {
    try {
        const params = event.queryStringParameters || {};
        const { movie, actor, awardBody } = params;
        let filter = "begins_with(pk, :w)";
        const values = { ":w": { S: "w" } };
        if (movie) {
            filter += " AND contains(pk, :movie)";
            values[":movie"] = { S: movie };
        }
        if (actor) {
            filter += " AND contains(pk, :actor)";
            values[":actor"] = { S: actor };
        }
        if (awardBody) {
            filter += " AND contains(sk, :body)";
            values[":body"] = { S: awardBody };
        }
        const data = await client.send(new client_dynamodb_1.ScanCommand({
            TableName: process.env.TABLE_NAME,
            FilterExpression: filter,
            ExpressionAttributeValues: values,
        }));
        const awards = data.Items?.map((i) => (0, util_dynamodb_1.unmarshall)(i)) || [];
        return { statusCode: 200, body: JSON.stringify(awards) };
    }
    catch (err) {
        console.error("Error in GetAwardsLambda:", err);
        return { statusCode: 500, body: JSON.stringify({ error: err.message }) };
    }
};
exports.handler = handler;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2V0QXdhcmRzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZ2V0QXdhcmRzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLDhEQUF1RTtBQUN2RSwwREFBb0Q7QUFHcEQsTUFBTSxNQUFNLEdBQUcsSUFBSSxnQ0FBYyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBRS9CLE1BQU0sT0FBTyxHQUFHLEtBQUssRUFBRSxLQUEyQixFQUFrQyxFQUFFO0lBQzNGLElBQUksQ0FBQztRQUNILE1BQU0sTUFBTSxHQUFHLEtBQUssQ0FBQyxxQkFBcUIsSUFBSSxFQUFFLENBQUM7UUFDakQsTUFBTSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLEdBQUcsTUFBTSxDQUFDO1FBRTNDLElBQUksTUFBTSxHQUFHLHFCQUFxQixDQUFDO1FBQ25DLE1BQU0sTUFBTSxHQUF3QixFQUFFLElBQUksRUFBRSxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsRUFBRSxDQUFDO1FBRXpELElBQUksS0FBSyxFQUFFLENBQUM7WUFDVixNQUFNLElBQUksMkJBQTJCLENBQUM7WUFDdEMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDO1FBQ2xDLENBQUM7UUFDRCxJQUFJLEtBQUssRUFBRSxDQUFDO1lBQ1YsTUFBTSxJQUFJLDJCQUEyQixDQUFDO1lBQ3RDLE1BQU0sQ0FBQyxRQUFRLENBQUMsR0FBRyxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQztRQUNsQyxDQUFDO1FBQ0QsSUFBSSxTQUFTLEVBQUUsQ0FBQztZQUNkLE1BQU0sSUFBSSwwQkFBMEIsQ0FBQztZQUNyQyxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsU0FBUyxFQUFFLENBQUM7UUFDckMsQ0FBQztRQUVELE1BQU0sSUFBSSxHQUFHLE1BQU0sTUFBTSxDQUFDLElBQUksQ0FDNUIsSUFBSSw2QkFBVyxDQUFDO1lBQ2QsU0FBUyxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVTtZQUNqQyxnQkFBZ0IsRUFBRSxNQUFNO1lBQ3hCLHlCQUF5QixFQUFFLE1BQU07U0FDbEMsQ0FBQyxDQUNILENBQUM7UUFFRixNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsSUFBQSwwQkFBVSxFQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQzNELE9BQU8sRUFBRSxVQUFVLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUM7SUFDM0QsQ0FBQztJQUFDLE9BQU8sR0FBUSxFQUFFLENBQUM7UUFDbEIsT0FBTyxDQUFDLEtBQUssQ0FBQywyQkFBMkIsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUNoRCxPQUFPLEVBQUUsVUFBVSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUMsRUFBRSxDQUFDO0lBQzNFLENBQUM7QUFDSCxDQUFDLENBQUM7QUFuQ1csUUFBQSxPQUFPLFdBbUNsQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IER5bmFtb0RCQ2xpZW50LCBTY2FuQ29tbWFuZCB9IGZyb20gXCJAYXdzLXNkay9jbGllbnQtZHluYW1vZGJcIjtcclxuaW1wb3J0IHsgdW5tYXJzaGFsbCB9IGZyb20gXCJAYXdzLXNkay91dGlsLWR5bmFtb2RiXCI7XHJcbmltcG9ydCB7IEFQSUdhdGV3YXlQcm94eUV2ZW50LCBBUElHYXRld2F5UHJveHlSZXN1bHQgfSBmcm9tIFwiYXdzLWxhbWJkYVwiO1xyXG5cclxuY29uc3QgY2xpZW50ID0gbmV3IER5bmFtb0RCQ2xpZW50KHt9KTtcclxuXHJcbmV4cG9ydCBjb25zdCBoYW5kbGVyID0gYXN5bmMgKGV2ZW50OiBBUElHYXRld2F5UHJveHlFdmVudCk6IFByb21pc2U8QVBJR2F0ZXdheVByb3h5UmVzdWx0PiA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHBhcmFtcyA9IGV2ZW50LnF1ZXJ5U3RyaW5nUGFyYW1ldGVycyB8fCB7fTtcclxuICAgIGNvbnN0IHsgbW92aWUsIGFjdG9yLCBhd2FyZEJvZHkgfSA9IHBhcmFtcztcclxuXHJcbiAgICBsZXQgZmlsdGVyID0gXCJiZWdpbnNfd2l0aChwaywgOncpXCI7XHJcbiAgICBjb25zdCB2YWx1ZXM6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7IFwiOndcIjogeyBTOiBcIndcIiB9IH07XHJcblxyXG4gICAgaWYgKG1vdmllKSB7XHJcbiAgICAgIGZpbHRlciArPSBcIiBBTkQgY29udGFpbnMocGssIDptb3ZpZSlcIjtcclxuICAgICAgdmFsdWVzW1wiOm1vdmllXCJdID0geyBTOiBtb3ZpZSB9O1xyXG4gICAgfVxyXG4gICAgaWYgKGFjdG9yKSB7XHJcbiAgICAgIGZpbHRlciArPSBcIiBBTkQgY29udGFpbnMocGssIDphY3RvcilcIjtcclxuICAgICAgdmFsdWVzW1wiOmFjdG9yXCJdID0geyBTOiBhY3RvciB9O1xyXG4gICAgfVxyXG4gICAgaWYgKGF3YXJkQm9keSkge1xyXG4gICAgICBmaWx0ZXIgKz0gXCIgQU5EIGNvbnRhaW5zKHNrLCA6Ym9keSlcIjtcclxuICAgICAgdmFsdWVzW1wiOmJvZHlcIl0gPSB7IFM6IGF3YXJkQm9keSB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBjbGllbnQuc2VuZChcclxuICAgICAgbmV3IFNjYW5Db21tYW5kKHtcclxuICAgICAgICBUYWJsZU5hbWU6IHByb2Nlc3MuZW52LlRBQkxFX05BTUUsXHJcbiAgICAgICAgRmlsdGVyRXhwcmVzc2lvbjogZmlsdGVyLFxyXG4gICAgICAgIEV4cHJlc3Npb25BdHRyaWJ1dGVWYWx1ZXM6IHZhbHVlcyxcclxuICAgICAgfSlcclxuICAgICk7XHJcblxyXG4gICAgY29uc3QgYXdhcmRzID0gZGF0YS5JdGVtcz8ubWFwKChpKSA9PiB1bm1hcnNoYWxsKGkpKSB8fCBbXTtcclxuICAgIHJldHVybiB7IHN0YXR1c0NvZGU6IDIwMCwgYm9keTogSlNPTi5zdHJpbmdpZnkoYXdhcmRzKSB9O1xyXG4gIH0gY2F0Y2ggKGVycjogYW55KSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgaW4gR2V0QXdhcmRzTGFtYmRhOlwiLCBlcnIpO1xyXG4gICAgcmV0dXJuIHsgc3RhdHVzQ29kZTogNTAwLCBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGVycm9yOiBlcnIubWVzc2FnZSB9KSB9O1xyXG4gIH1cclxufTtcclxuIl19